<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Organigrammer</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
</head>

<body>
    <div id="container">
        <div id="reload">
            <a>
                <img id="imgReload" src="img/reload.svg" onClick="window.location.reload()" />
            </a>
        </div>
        <div>
            <a href="chooseOptions.html">
                <img id="imgBack" src="img/back.svg" />
            </a>
        </div>
        <h2>Mitarbeiter hinzufügen</h2>
        <div>
            <table align="center">
                <tr>
                    <td width="(100/2)%">Name</td>
                    <td width="(100/2)%"><input type="text" name="name" id="name"></td>
                </tr>
                <tr>
                    <td width="(100/2)%">Titel</td>
                    <td width="(100/2)%"><input type="text" name="title" id="title"></td>
                </tr>
                <tr>
                    <td width="(100/2)%">Position</td>
                    <td width="(100/2)%"><input type="text" name="position" id="position"></td>
                </tr>
                <tr>
                    <td width="(100/2)%">Bezahlung</td>
                    <td width="(100/2)%"><input type="text" name="payment" id="payment"></td>
                </tr>
                <tr>
                    <td width="(100/2)%">Vorgesetzter</td>
                    <td width="(100/2)%"><input type="text" name="supervisor" id="supervisor"></td>
                </tr>
                <tr>
                    <td width="(100/2)%">Priorität</td>
                    <td width="(100/2)%"><input type="text" name="priority" id="priority"></td>
                </tr>
            </table>
            <div class="centerButton">
                <button type="button" onclick="confirm()">Bestätigen</button>
            </div>
            
        </div>
    </div>
    <script>
        var remote = require('electron').remote;
        document.addEventListener('keydown', function(e) {
            if (e.which === 123) {
                remote.getCurrentWindow().webContents.openDevTools();
            } else if (e.which === 116) {
                location.reload();
            }
        });

        function confirm() {
            var name = document.getElementById('name').value;
            var title = document.getElementById('title').value;
            var position = document.getElementById('position').value;
            var payment = document.getElementById('payment').value;
            var supervisor = document.getElementById('supervisor').value;
            var priority = document.getElementById('priority').value;

            const storage = require('electron-json-storage');

            storage.has('staff', function(error, hasKey) {
                if (error) throw error;
                if (hasKey) {
                    storage.get('staff', function(error, data) {
                        if (error) throw error;
                        data.push({
                            name: name,
                            title: title,
                            position: position,
                            payment: payment,
                            supervisor: supervisor,
                            priority: priority
                        });
                        data.sort(function(a, b) {
                            return a.priority - b.priority;
                        });
                        storage.set('staff', data, (err) => {
                            if (err) {
                                console.log(err);
                            }
                        });
                    });
                }
                if (!hasKey) {
                    var staff = [{
                        name: name,
                        title: title,
                        position: position,
                        payment: payment,
                        supervisor: supervisor,
                        priority: priority
                    }];
                    storage.set('staff', staff, (err) => {
                        if (err) {
                            console.log(err);
                        }
                    });
                }
            });
            document.getElementById('name').value = "";
            document.getElementById('title').value = "";
            document.getElementById('position').value = "";
            document.getElementById('payment').value = "";
            document.getElementById('supervisor').value = "";
            document.getElementById('priority').value = "";
        }
    </script>
</body>

</html>